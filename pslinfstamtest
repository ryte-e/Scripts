-- Nexus UI Library | Advanced Animated UI
-- Version: 1.0.0
-- Author: Custom

local NexusLib = {}
NexusLib.__index = NexusLib

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

-- Variables
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- UI Configuration
local Config = {
    Theme = {
        Primary = Color3.fromRGB(45, 45, 55),
        Secondary = Color3.fromRGB(35, 35, 45),
        Accent = Color3.fromRGB(88, 101, 242),
        Text = Color3.fromRGB(255, 255, 255),
        TextDark = Color3.fromRGB(150, 150, 150),
        Success = Color3.fromRGB(67, 181, 129),
        Warning = Color3.fromRGB(250, 166, 26),
        Error = Color3.fromRGB(240, 71, 71),
        Background = Color3.fromRGB(25, 25, 32)
    },
    Animation = {
        EasingStyle = Enum.EasingStyle.Quart,
        EasingDirection = Enum.EasingDirection.Out,
        DefaultTime = 0.3
    },
    Effects = {
        ParticleEnabled = true,
        NetworkLinesEnabled = true,
        BlurEnabled = true,
        RippleEnabled = true
    }
}

-- Utility Functions
local function CreateInstance(class, properties)
    local instance = Instance.new(class)
    for prop, value in pairs(properties) do
        instance[prop] = value
    end
    return instance
end

local function Tween(object, properties, duration)
    duration = duration or Config.Animation.DefaultTime
    local tween = TweenService:Create(
        object,
        TweenInfo.new(duration, Config.Animation.EasingStyle, Config.Animation.EasingDirection),
        properties
    )
    tween:Play()
    return tween
end

-- Particle System
local ParticleSystem = {}
ParticleSystem.__index = ParticleSystem

function ParticleSystem.new(parent)
    local self = setmetatable({}, ParticleSystem)
    self.Parent = parent
    self.Particles = {}
    self.Active = true
    
    -- Network Lines Container
    self.NetworkContainer = CreateInstance("Frame", {
        Name = "NetworkLines",
        Parent = parent,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        ZIndex = 1
    })
    
    self:StartAnimation()
    return self
end

function ParticleSystem:CreateNetworkLine(startPos, endPos)
    local line = CreateInstance("Frame", {
        Parent = self.NetworkContainer,
        BackgroundColor3 = Config.Theme.Accent,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        AnchorPoint = Vector2.new(0.5, 0.5)
    })
    
    -- Calculate line properties
    local deltaX = endPos.X - startPos.X
    local deltaY = endPos.Y - startPos.Y
    local distance = math.sqrt(deltaX^2 + deltaY^2)
    local angle = math.atan2(deltaY, deltaX)
    
    line.Size = UDim2.new(0, distance, 0, 2)
    line.Position = UDim2.new(0, (startPos.X + endPos.X) / 2, 0, (startPos.Y + endPos.Y) / 2)
    line.Rotation = math.deg(angle)
    
    -- Animate line
    Tween(line, {BackgroundTransparency = 1}, 2)
    
    task.wait(2)
    line:Destroy()
end

function ParticleSystem:CreateRipple(position)
    local ripple = CreateInstance("Frame", {
        Parent = self.Parent,
        BackgroundColor3 = Config.Theme.Accent,
        BackgroundTransparency = 0.5,
        Size = UDim2.new(0, 10, 0, 10),
        Position = UDim2.new(0, position.X, 0, position.Y),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = 100
    })
    
    CreateInstance("UICorner", {
        Parent = ripple,
        CornerRadius = UDim.new(1, 0)
    })
    
    Tween(ripple, {
        Size = UDim2.new(0, 100, 0, 100),
        BackgroundTransparency = 1
    }, 0.5)
    
    task.wait(0.5)
    ripple:Destroy()
end

function ParticleSystem:StartAnimation()
    task.spawn(function()
        while self.Active do
            if Config.Effects.NetworkLinesEnabled then
                -- Create random network lines
                for i = 1, 3 do
                    task.spawn(function()
                        local start = Vector2.new(
                            math.random(0, self.Parent.AbsoluteSize.X),
                            math.random(0, self.Parent.AbsoluteSize.Y)
                        )
                        local endPos = Vector2.new(
                            math.random(0, self.Parent.AbsoluteSize.X),
                            math.random(0, self.Parent.AbsoluteSize.Y)
                        )
                        self:CreateNetworkLine(start, endPos)
                    end)
                end
            end
            task.wait(1)
        end
    end)
end

-- Main Window Class
function NexusLib:CreateWindow(options)
    options = options or {}
    
    local Window = {
        Name = options.Name or "Nexus UI",
        SubTitle = options.SubTitle or "Premium Interface",
        Icon = options.Icon or "rbxassetid://7733960981",
        Background = options.Background or nil,
        AnimatedBackground = options.AnimatedBackground or true,
        Tabs = {},
        Notifications = {}
    }
    
    -- Main ScreenGui
    Window.GUI = CreateInstance("ScreenGui", {
        Name = "NexusUI",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })
    
    -- Main Frame
    Window.Main = CreateInstance("Frame", {
        Name = "MainFrame",
        Parent = Window.GUI,
        BackgroundColor3 = Config.Theme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -300, 0.5, -250),
        Size = UDim2.new(0, 600, 0, 500),
        AnchorPoint = Vector2.new(0.5, 0.5)
    })
    
    CreateInstance("UICorner", {
        Parent = Window.Main,
        CornerRadius = UDim.new(0, 12)
    })
    
    -- Shadow Effect
    local Shadow = CreateInstance("ImageLabel", {
        Name = "Shadow",
        Parent = Window.Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -20, 0, -20),
        Size = UDim2.new(1, 40, 1, 40),
        ZIndex = -1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277)
    })
    
    -- Custom Background
    if options.Background then
        local CustomBG = CreateInstance("ImageLabel", {
            Parent = Window.Main,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            Image = options.Background,
            ImageTransparency = 0.7,
            ZIndex = 1
        })
        
        CreateInstance("UICorner", {
            Parent = CustomBG,
            CornerRadius = UDim.new(0, 12)
        })
    end
    
    -- Animated Background
    if options.AnimatedBackground then
        Window.ParticleSystem = ParticleSystem.new(Window.Main)
    end
    
    -- Top Bar
    Window.TopBar = CreateInstance("Frame", {
        Name = "TopBar",
        Parent = Window.Main,
        BackgroundColor3 = Config.Theme.Secondary,
        Size = UDim2.new(1, 0, 0, 50),
        ZIndex = 2
    })
    
    CreateInstance("UICorner", {
        Parent = Window.TopBar,
        CornerRadius = UDim.new(0, 12)
    })
    
    local TopBarBottom = CreateInstance("Frame", {
        Parent = Window.TopBar,
        BackgroundColor3 = Config.Theme.Secondary,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0.5, 0),
        Size = UDim2.new(1, 0, 0.5, 0),
        ZIndex = 2
    })
    
    -- Title Section
    local TitleContainer = CreateInstance("Frame", {
        Parent = Window.TopBar,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.5, 0, 1, 0),
        ZIndex = 3
    })
    
    local IconLabel = CreateInstance("ImageLabel", {
        Parent = TitleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 0.5, -12),
        Size = UDim2.new(0, 24, 0, 24),
        Image = Window.Icon,
        ImageColor3 = Config.Theme.Accent,
        ZIndex = 3
    })
    
    local TitleLabel = CreateInstance("TextLabel", {
        Parent = TitleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 50, 0, 8),
        Size = UDim2.new(0, 200, 0, 20),
        Font = Enum.Font.Gotham,
        Text = Window.Name,
        TextColor3 = Config.Theme.Text,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 3
    })
    
    local SubTitleLabel = CreateInstance("TextLabel", {
        Parent = TitleContainer,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 50, 0, 25),
        Size = UDim2.new(0, 200, 0, 15),
        Font = Enum.Font.Gotham,
        Text = Window.SubTitle,
        TextColor3 = Config.Theme.TextDark,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 3
    })
    
    -- Control Buttons
    local CloseButton = CreateInstance("TextButton", {
        Parent = Window.TopBar,
        BackgroundColor3 = Config.Theme.Error,
        Position = UDim2.new(1, -35, 0.5, -10),
        Size = UDim2.new(0, 20, 0, 20),
        Text = "",
        ZIndex = 4
    })
    
    CreateInstance("UICorner", {
        Parent = CloseButton,
        CornerRadius = UDim.new(0, 4)
    })
    
    local CloseIcon = CreateInstance("ImageLabel", {
        Parent = CloseButton,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 0.7, 0),
        Position = UDim2.new(0.15, 0, 0.15, 0),
        Image = "rbxassetid://7733717447",
        ImageColor3 = Config.Theme.Text,
        ZIndex = 5
    })
    
    CloseButton.MouseButton1Click:Connect(function()
        if Window.ParticleSystem then
            Window.ParticleSystem.Active = false
        end
        Tween(Window.Main, {Size = UDim2.new(0, 0, 0, 0)}, 0.3)
        task.wait(0.3)
        Window.GUI:Destroy()
    end)
    
    -- Minimize Button
    local MinimizeButton = CreateInstance("TextButton", {
        Parent = Window.TopBar,
        BackgroundColor3 = Config.Theme.Warning,
        Position = UDim2.new(1, -60, 0.5, -10),
        Size = UDim2.new(0, 20, 0, 20),
        Text = "",
        ZIndex = 4
    })
    
    CreateInstance("UICorner", {
        Parent = MinimizeButton,
        CornerRadius = UDim.new(0, 4)
    })
    
    local isMinimized = false
    MinimizeButton.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        if isMinimized then
            Tween(Window.Main, {Size = UDim2.new(0, 600, 0, 50)}, 0.3)
        else
            Tween(Window.Main, {Size = UDim2.new(0, 600, 0, 500)}, 0.3)
        end
    end)
    
    -- Tab Container
    Window.TabContainer = CreateInstance("Frame", {
        Parent = Window.Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 60),
        Size = UDim2.new(0, 150, 1, -70),
        ZIndex = 2
    })
    
    local TabList = CreateInstance("ScrollingFrame", {
        Parent = Window.TabContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Config.Theme.Accent,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ZIndex = 2
    })
    
    CreateInstance("UIListLayout", {
        Parent = TabList,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5)
    })
    
    -- Content Container
    Window.ContentContainer = CreateInstance("Frame", {
        Parent = Window.Main,
        BackgroundColor3 = Config.Theme.Primary,
        Position = UDim2.new(0, 170, 0, 60),
        Size = UDim2.new(1, -180, 1, -70),
        ZIndex = 2
    })
    
    CreateInstance("UICorner", {
        Parent = Window.ContentContainer,
        CornerRadius = UDim.new(0, 8)
    })
    
    -- Tab Functions
    function Window:CreateTab(tabOptions)
        tabOptions = tabOptions or {}
        local Tab = {
            Name = tabOptions.Name or "Tab",
            Icon = tabOptions.Icon or "rbxassetid://7733960981",
            Elements = {}
        }
        
        -- Tab Button
        Tab.Button = CreateInstance("TextButton", {
            Parent = TabList,
            BackgroundColor3 = Config.Theme.Secondary,
            Size = UDim2.new(1, -10, 0, 35),
            Text = "",
            ZIndex = 3
        })
        
        CreateInstance("UICorner", {
            Parent = Tab.Button,
            CornerRadius = UDim.new(0, 6)
        })
        
        local TabIcon = CreateInstance("ImageLabel", {
            Parent = Tab.Button,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 8, 0.5, -10),
            Size = UDim2.new(0, 20, 0, 20),
            Image = Tab.Icon,
            ImageColor3 = Config.Theme.TextDark,
            ZIndex = 4
        })
        
        local TabLabel = CreateInstance("TextLabel", {
            Parent = Tab.Button,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 35, 0, 0),
            Size = UDim2.new(1, -35, 1, 0),
            Font = Enum.Font.Gotham,
            Text = Tab.Name,
            TextColor3 = Config.Theme.TextDark,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left,
            ZIndex = 4
        })
        
        -- Tab Content
        Tab.Content = CreateInstance("ScrollingFrame", {
            Parent = Window.ContentContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -10, 1, -10),
            Position = UDim2.new(0, 5, 0, 5),
            ScrollBarThickness = 3,
            ScrollBarImageColor3 = Config.Theme.Accent,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            Visible = false,
            ZIndex = 3
        })
        
        CreateInstance("UIListLayout", {
            Parent = Tab.Content,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 8)
        })
        
        -- Tab Selection
        Tab.Button.MouseButton1Click:Connect(function()
            -- Ripple Effect
            if Config.Effects.RippleEnabled and Window.ParticleSystem then
                local mousePos = UserInputService:GetMouseLocation()
                local guiPos = Window.Main.AbsolutePosition
                local relativePos = Vector2.new(
                    mousePos.X - guiPos.X,
                    mousePos.Y - guiPos.Y
                )
                Window.ParticleSystem:CreateRipple(relativePos)
            end
            
            -- Hide all tabs
            for _, tab in pairs(Window.Tabs) do
                tab.Content.Visible = false
                Tween(tab.Button, {BackgroundColor3 = Config.Theme.Secondary}, 0.2)
                tab.Button:FindFirstChildWhichIsA("ImageLabel").ImageColor3 = Config.Theme.TextDark
                tab.Button:FindFirstChildWhichIsA("TextLabel").TextColor3 = Config.Theme.TextDark
            end
            
            -- Show selected tab
            Tab.Content.Visible = true
            Tween(Tab.Button, {BackgroundColor3 = Config.Theme.Accent}, 0.2)
            TabIcon.ImageColor3 = Config.Theme.Text
            TabLabel.TextColor3 = Config.Theme.Text
        end)
        
        -- Element Creation Functions
        function Tab:AddButton(buttonOptions)
            buttonOptions = buttonOptions or {}
            
            local ButtonFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, 0, 0, 40),
                ZIndex = 4
            })
            
            CreateInstance("UICorner", {
                Parent = ButtonFrame,
                CornerRadius = UDim.new(0, 6)
            })
            
            local Button = CreateInstance("TextButton", {
                Parent = ButtonFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = buttonOptions.Name or "Button",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 14,
                ZIndex = 5
            })
            
            Button.MouseEnter:Connect(function()
                Tween(ButtonFrame, {BackgroundColor3 = Config.Theme.Accent}, 0.2)
            end)
            
            Button.MouseLeave:Connect(function()
                Tween(ButtonFrame, {BackgroundColor3 = Config.Theme.Secondary}, 0.2)
            end)
            
            Button.MouseButton1Click:Connect(function()
                if buttonOptions.Callback then
                    buttonOptions.Callback()
                end
            end)
            
            return Button
        end
        
        function Tab:AddToggle(toggleOptions)
            toggleOptions = toggleOptions or {}
            local toggled = toggleOptions.Default or false
            
            local ToggleFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, 0, 0, 40),
                ZIndex = 4
            })
            
            CreateInstance("UICorner", {
                Parent = ToggleFrame,
                CornerRadius = UDim.new(0, 6)
            })
            
            local ToggleLabel = CreateInstance("TextLabel", {
                Parent = ToggleFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0.7, 0, 1, 0),
                Text = toggleOptions.Name or "Toggle",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left,
                ZIndex = 5
            })
            
            local ToggleButton = CreateInstance("Frame", {
                Parent = ToggleFrame,
                BackgroundColor3 = toggled and Config.Theme.Success or Config.Theme.Primary,
                Position = UDim2.new(1, -50, 0.5, -10),
                Size = UDim2.new(0, 40, 0, 20),
                ZIndex = 5
            })
            
            CreateInstance("UICorner", {
                Parent = ToggleButton,
                CornerRadius = UDim.new(1, 0)
            })
            
            local ToggleCircle = CreateInstance("Frame", {
                Parent = ToggleButton,
                BackgroundColor3 = Config.Theme.Text,
                Position = toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8),
                Size = UDim2.new(0, 16, 0, 16),
                ZIndex = 6
            })
            
            CreateInstance("UICorner", {
                Parent = ToggleCircle,
                CornerRadius = UDim.new(1, 0)
            })
            
            local ToggleDetector = CreateInstance("TextButton", {
                Parent = ToggleFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                ZIndex = 7
            })
            
            ToggleDetector.MouseButton1Click:Connect(function()
                toggled = not toggled
                
                Tween(ToggleButton, {
                    BackgroundColor3 = toggled and Config.Theme.Success or Config.Theme.Primary
                }, 0.2)
                
                Tween(ToggleCircle, {
                    Position = toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                }, 0.2)
                
                if toggleOptions.Callback then
                    toggleOptions.Callback(toggled)
                end
            end)
            
            return {Frame = ToggleFrame, Value = toggled}
        end
        
        function Tab:AddSlider(sliderOptions)
            sliderOptions = sliderOptions or {}
            local value = sliderOptions.Default or sliderOptions.Min or 0
            local min = sliderOptions.Min or 0
            local max = sliderOptions.Max or 100
            
            local SliderFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, 0, 0, 60),
                ZIndex = 4
            })
            
            CreateInstance("UICorner", {
                Parent = SliderFrame,
                CornerRadius = UDim.new(0, 6)
            })
            
            local SliderLabel = CreateInstance("TextLabel", {
                Parent = SliderFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 5),
                Size = UDim2.new(0.7, 0, 0, 20),
                Text = sliderOptions.Name or "Slider",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left,
                ZIndex = 5
            })
            
            local ValueLabel = CreateInstance("TextLabel", {
                Parent = SliderFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -50, 0, 5),
                Size = UDim2.new(0, 40, 0, 20),
                Text = tostring(value),
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Accent,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Right,
                ZIndex = 5
            })
            
            local SliderBar = CreateInstance("Frame", {
                Parent = SliderFrame,
                BackgroundColor3 = Config.Theme.Primary,
                Position = UDim2.new(0, 10, 0, 35),
                Size = UDim2.new(1, -20, 0, 6),
                ZIndex = 5
            })
            
            CreateInstance("UICorner", {
                Parent = SliderBar,
                CornerRadius = UDim.new(1, 0)
            })
            
            local SliderFill = CreateInstance("Frame", {
                Parent = SliderBar,
                BackgroundColor3 = Config.Theme.Accent,
                Size = UDim2.new((value - min) / (max - min), 0, 1, 0),
                ZIndex = 6
            })
            
            CreateInstance("UICorner", {
                Parent = SliderFill,
                CornerRadius = UDim.new(1, 0)
            })
            
            local SliderButton = CreateInstance("TextButton", {
                Parent = SliderBar,
                BackgroundColor3 = Config.Theme.Text,
                Position = UDim2.new((value - min) / (max - min), -8, 0.5, -8),
                Size = UDim2.new(0, 16, 0, 16),
                Text = "",
                ZIndex = 7
            })
            
            CreateInstance("UICorner", {
                Parent = SliderButton,
                CornerRadius = UDim.new(1, 0)
            })
            
            local dragging = false
            
            SliderButton.MouseButton1Down:Connect(function()
                dragging = true
            end)
            
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)
            
            RunService.RenderStepped:Connect(function()
                if dragging then
                    local mousePos = Mouse.X
                    local barPos = SliderBar.AbsolutePosition.X
                    local barSize = SliderBar.AbsoluteSize.X
                    local pos = math.clamp((mousePos - barPos) / barSize, 0, 1)
                    
                    value = math.floor(min + (max - min) * pos)
                    ValueLabel.Text = tostring(value)
                    
                    Tween(SliderButton, {Position = UDim2.new(pos, -8, 0.5, -8)}, 0.05)
                    Tween(SliderFill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.05)
                    
                    if sliderOptions.Callback then
                        sliderOptions.Callback(value)
                    end
                end
            end)
            
            return {Frame = SliderFrame, Value = value}
        end
        
        function Tab:AddTextbox(textboxOptions)
            textboxOptions = textboxOptions or {}
            
            local TextboxFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, 0, 0, 40),
                ZIndex = 4
            })
            
            CreateInstance("UICorner", {
                Parent = TextboxFrame,
                CornerRadius = UDim.new(0, 6)
            })
            
            local TextboxLabel = CreateInstance("TextLabel", {
                Parent = TextboxFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0.4, 0, 1, 0),
                Text = textboxOptions.Name or "Textbox",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left,
                ZIndex = 5
            })
            
            local TextBox = CreateInstance("TextBox", {
                Parent = TextboxFrame,
                BackgroundColor3 = Config.Theme.Primary,
                Position = UDim2.new(0.45, 0, 0.5, -12),
                Size = UDim2.new(0.5, 0, 0, 24),
                Font = Enum.Font.Gotham,
                PlaceholderText = textboxOptions.Placeholder or "Enter text...",
                PlaceholderColor3 = Config.Theme.TextDark,
                Text = textboxOptions.Default or "",
                TextColor3 = Config.Theme.Text,
                TextSize = 12,
                ZIndex = 5
            })
            
            CreateInstance("UICorner", {
                Parent = TextBox,
                CornerRadius = UDim.new(0, 4)
            })
            
            TextBox.FocusLost:Connect(function()
                if textboxOptions.Callback then
                    textboxOptions.Callback(TextBox.Text)
                end
            end)
            
            return TextBox
        end
        
        function Tab:AddDropdown(dropdownOptions)
            dropdownOptions = dropdownOptions or {}
            local options = dropdownOptions.Options or {}
            local selected = dropdownOptions.Default or options[1] or "None"
            local isOpen = false
            
            local DropdownFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, 0, 0, 40),
                ZIndex = 10
            })
            
            CreateInstance("UICorner", {
                Parent = DropdownFrame,
                CornerRadius = UDim.new(0, 6)
            })
            
            local DropdownLabel = CreateInstance("TextLabel", {
                Parent = DropdownFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0.4, 0, 0, 40),
                Text = dropdownOptions.Name or "Dropdown",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left,
                ZIndex = 11
            })
            
            local DropdownButton = CreateInstance("TextButton", {
                Parent = DropdownFrame,
                BackgroundColor3 = Config.Theme.Primary,
                Position = UDim2.new(0.45, 0, 0, 8),
                Size = UDim2.new(0.5, 0, 0, 24),
                Text = selected,
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 12,
                ZIndex = 11
            })
            
            CreateInstance("UICorner", {
                Parent = DropdownButton,
                CornerRadius = UDim.new(0, 4)
            })
            
            local DropdownIcon = CreateInstance("ImageLabel", {
                Parent = DropdownButton,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -20, 0.5, -6),
                Size = UDim2.new(0, 12, 0, 12),
                Image = "rbxassetid://7733717447",
                ImageColor3 = Config.Theme.TextDark,
                Rotation = 90,
                ZIndex = 12
            })
            
            local DropdownList = CreateInstance("Frame", {
                Parent = DropdownFrame,
                BackgroundColor3 = Config.Theme.Primary,
                Position = UDim2.new(0.45, 0, 0, 35),
                Size = UDim2.new(0.5, 0, 0, 0),
                ClipsDescendants = true,
                ZIndex = 15
            })
            
            CreateInstance("UICorner", {
                Parent = DropdownList,
                CornerRadius = UDim.new(0, 4)
            })
            
            local DropdownLayout = CreateInstance("UIListLayout", {
                Parent = DropdownList,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 2)
            })
            
            for _, option in pairs(options) do
                local OptionButton = CreateInstance("TextButton", {
                    Parent = DropdownList,
                    BackgroundColor3 = Config.Theme.Secondary,
                    Size = UDim2.new(1, 0, 0, 25),
                    Text = option,
                    Font = Enum.Font.Gotham,
                    TextColor3 = Config.Theme.Text,
                    TextSize = 12,
                    ZIndex = 16
                })
                
                OptionButton.MouseEnter:Connect(function()
                    Tween(OptionButton, {BackgroundColor3 = Config.Theme.Accent}, 0.1)
                end)
                
                OptionButton.MouseLeave:Connect(function()
                    Tween(OptionButton, {BackgroundColor3 = Config.Theme.Secondary}, 0.1)
                end)
                
                OptionButton.MouseButton1Click:Connect(function()
                    selected = option
                    DropdownButton.Text = selected
                    isOpen = false
                    Tween(DropdownFrame, {Size = UDim2.new(1, 0, 0, 40)}, 0.2)
                    Tween(DropdownList, {Size = UDim2.new(0.5, 0, 0, 0)}, 0.2)
                    Tween(DropdownIcon, {Rotation = 90}, 0.2)
                    
                    if dropdownOptions.Callback then
                        dropdownOptions.Callback(selected)
                    end
                end)
            end
            
            DropdownButton.MouseButton1Click:Connect(function()
                isOpen = not isOpen
                local listHeight = #options * 27
                
                if isOpen then
                    Tween(DropdownFrame, {Size = UDim2.new(1, 0, 0, 40 + listHeight)}, 0.2)
                    Tween(DropdownList, {Size = UDim2.new(0.5, 0, 0, listHeight)}, 0.2)
                    Tween(DropdownIcon, {Rotation = 270}, 0.2)
                else
                    Tween(DropdownFrame, {Size = UDim2.new(1, 0, 0, 40)}, 0.2)
                    Tween(DropdownList, {Size = UDim2.new(0.5, 0, 0, 0)}, 0.2)
                    Tween(DropdownIcon, {Rotation = 90}, 0.2)
                end
            end)
            
            return {Frame = DropdownFrame, Value = selected}
        end
        
        function Tab:AddColorpicker(colorpickerOptions)
            colorpickerOptions = colorpickerOptions or {}
            local color = colorpickerOptions.Default or Color3.fromRGB(255, 255, 255)
            
            local ColorpickerFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, 0, 0, 40),
                ZIndex = 4
            })
            
            CreateInstance("UICorner", {
                Parent = ColorpickerFrame,
                CornerRadius = UDim.new(0, 6)
            })
            
            local ColorpickerLabel = CreateInstance("TextLabel", {
                Parent = ColorpickerFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(0.7, 0, 1, 0),
                Text = colorpickerOptions.Name or "Color Picker",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left,
                ZIndex = 5
            })
            
            local ColorDisplay = CreateInstance("Frame", {
                Parent = ColorpickerFrame,
                BackgroundColor3 = color,
                Position = UDim2.new(1, -35, 0.5, -10),
                Size = UDim2.new(0, 25, 0, 20),
                ZIndex = 5
            })
            
            CreateInstance("UICorner", {
                Parent = ColorDisplay,
                CornerRadius = UDim.new(0, 4)
            })
            
            local ColorButton = CreateInstance("TextButton", {
                Parent = ColorDisplay,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = "",
                ZIndex = 6
            })
            
            ColorButton.MouseButton1Click:Connect(function()
                -- Simple color picker implementation
                local h, s, v = Color3.toHSV(color)
                h = (h + 0.1) % 1
                color = Color3.fromHSV(h, s, v)
                ColorDisplay.BackgroundColor3 = color
                
                if colorpickerOptions.Callback then
                    colorpickerOptions.Callback(color)
                end
            end)
            
            return {Frame = ColorpickerFrame, Value = color}
        end
        
        function Tab:AddLabel(text)
            local LabelFrame = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 20),
                ZIndex = 4
            })
            
            local Label = CreateInstance("TextLabel", {
                Parent = LabelFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = text or "Label",
                Font = Enum.Font.Gotham,
                TextColor3 = Config.Theme.TextDark,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Center,
                ZIndex = 5
            })
            
            return Label
        end
        
        function Tab:AddSeparator()
            local Separator = CreateInstance("Frame", {
                Parent = Tab.Content,
                BackgroundColor3 = Config.Theme.TextDark,
                BackgroundTransparency = 0.7,
                Size = UDim2.new(1, 0, 0, 1),
                ZIndex = 4
            })
            
            return Separator
        end
        
        table.insert(Window.Tabs, Tab)
        
        -- Auto-select first tab
        if #Window.Tabs == 1 then
            Tab.Button.MouseButton1Click:Fire()
        end
        
        return Tab
    end
    
    -- Notification System
    function Window:Notify(notifOptions)
        notifOptions = notifOptions or {}
        
        local Notification = CreateInstance("Frame", {
            Parent = Window.GUI,
            BackgroundColor3 = Config.Theme.Secondary,
            Position = UDim2.new(1, 0, 1, -10),
            Size = UDim2.new(0, 300, 0, 80),
            ZIndex = 100
        })
        
        CreateInstance("UICorner", {
            Parent = Notification,
            CornerRadius = UDim.new(0, 8)
        })
        
        local NotifIcon = CreateInstance("ImageLabel", {
            Parent = Notification,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 10, 0.5, -15),
            Size = UDim2.new(0, 30, 0, 30),
            Image = notifOptions.Icon or "rbxassetid://7733960981",
            ImageColor3 = notifOptions.Color or Config.Theme.Accent,
            ZIndex = 101
        })
        
        local NotifTitle = CreateInstance("TextLabel", {
            Parent = Notification,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 50, 0, 10),
            Size = UDim2.new(1, -60, 0, 20),
            Text = notifOptions.Title or "Notification",
            Font = Enum.Font.GothamBold,
            TextColor3 = Config.Theme.Text,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left,
            ZIndex = 101
        })
        
        local NotifContent = CreateInstance("TextLabel", {
            Parent = Notification,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 50, 0, 30),
            Size = UDim2.new(1, -60, 0, 40),
            Text = notifOptions.Content or "Content",
            Font = Enum.Font.Gotham,
            TextColor3 = Config.Theme.TextDark,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true,
            ZIndex = 101
        })
        
        local ProgressBar = CreateInstance("Frame", {
            Parent = Notification,
            BackgroundColor3 = notifOptions.Color or Config.Theme.Accent,
            Position = UDim2.new(0, 0, 1, -3),
            Size = UDim2.new(1, 0, 0, 3),
            ZIndex = 102
        })
        
        CreateInstance("UICorner", {
            Parent = ProgressBar,
            CornerRadius = UDim.new(0, 2)
        })
        
        -- Animate notification
        Tween(Notification, {Position = UDim2.new(1, -310, 1, -90)}, 0.3)
        
        local duration = notifOptions.Duration or 3
        Tween(ProgressBar, {Size = UDim2.new(0, 0, 0, 3)}, duration)
        
        task.wait(duration)
        Tween(Notification, {Position = UDim2.new(1, 0, 1, -90)}, 0.3)
        task.wait(0.3)
        Notification:Destroy()
    end
    
    -- Dragging
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    Window.TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Window.Main.Position
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Window.Main.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Mobile Support
    if UserInputService.TouchEnabled then
        Window.Main.Size = UDim2.new(0, 500, 0, 400)
        Window.Main.Position = UDim2.new(0.5, 0, 0.5, 0)
        
        -- Add mobile toggle button
        local MobileToggle = CreateInstance("TextButton", {
            Parent = Window.GUI,
            BackgroundColor3 = Config.Theme.Accent,
            Position = UDim2.new(0, 10, 0.5, -25),
            Size = UDim2.new(0, 50, 0, 50),
            Text = "â˜°",
            Font = Enum.Font.GothamBold,
            TextColor3 = Config.Theme.Text,
            TextSize = 24,
            ZIndex = 200
        })
        
        CreateInstance("UICorner", {
            Parent = MobileToggle,
            CornerRadius = UDim.new(0, 8)
        })
        
        local isVisible = true
        MobileToggle.MouseButton1Click:Connect(function()
            isVisible = not isVisible
            Window.Main.Visible = isVisible
        end)
    end
    
    return Window
end

return NexusLib
